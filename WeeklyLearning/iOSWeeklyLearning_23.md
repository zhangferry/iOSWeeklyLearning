# iOSæ‘¸é±¼å‘¨æŠ¥ ç¬¬äºŒåä¸‰æœŸ

![](https://gitee.com/zhangferry/Images/raw/master/gitee/iOSæ‘¸é±¼å‘¨æŠ¥æ¨¡æ¿.png)

### æœ¬æœŸæ¦‚è¦

> * æœ¬æœŸé‚€è¯· CoderStar èŠä¸€ä¸‹ä»–çš„å­¦ä¹ æ–¹æ³•ã€‚
> * ç®€ç‰ˆ PromiseKit çš„è®¾è®¡æ€è·¯ï¼›å¦‚ä½•é€šè¿‡é…ç½®æ–‡ä»¶åŒºåˆ† AdHoc/AppStoreã€‚
> * `isMemberOfClass`ã€ `isKindOfClass` çš„å«ä¹‰ä¸åŒºåˆ«ã€‚
> * åšå®¢éƒ¨åˆ†æ•´ç†äº†Swift æŒ‡é’ˆã€Swift å±æ€§åŒ…è£¹å™¨çš„å‡ ç¯‡æ–‡ç« ã€‚
> * å­¦ä¹ èµ„æ–™ï¼š
> * ä¸€ä¸ªå¸®åŠ©è§£æ Shell è„šæœ¬çš„ç½‘ç«™ï¼šexplainshellã€‚

## æœ¬æœŸè¯é¢˜

[@zhangferry](https://zhangferry.com)ï¼šä¸Šå‘¨è·Ÿ [@å±•è²](https://github.com/fanbaoying) èŠè¿‡ä¹‹åï¼Œæœ‰äº†è¿™ä¸ªè·Ÿå„ä½åšä¸»è¿›è¡Œè®¿è°ˆçš„æƒ³æ³•ã€‚åšä¸»+è®¿è°ˆï¼Œå³å¯ä»¥å¸®å¤§å®¶ä»‹ç»ä¼˜ç§€çš„å¼€å‘è€…ï¼Œåˆèƒ½åˆ©ç”¨è®¿è°ˆçš„å½¢å¼è¿‘è·ç¦»äº†è§£åšä¸»ï¼Œå­¦ä¹ ä»–ä»¬çš„æ€è€ƒå’Œå­¦ä¹ æ–¹æ³•ã€‚æœ¬æœŸæ‰€é€‰é—®é¢˜æ˜¯ä¸€ä¸ªåˆæ­¥å°è¯•ï¼Œå¤§å®¶å¦‚æœæœ‰æ›´å¥½çš„é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€å‘Šè¯‰æˆ‘ä»¬ã€‚

æœ¬æœŸä»‹ç»çš„åšä¸»ä¹Ÿæ˜¯æ‘¸é±¼å‘¨æŠ¥çš„ä¸€ä½è”åˆç¼–è¾‘ï¼š[CoderStar](https://juejin.cn/user/588993964541288)ã€‚

### åšä¸»è®¿è°ˆ

zhangferryï¼šç®€å•ä»‹ç»ä¸‹è‡ªå·±å’Œè‡ªå·±çš„å…¬ä¼—å·å§

> è‡ªå·±ï¼šCoderStarï¼Œåæ ‡åŒ—äº¬ï¼Œç›®å‰ä¸»è¦å·¥ä½œä¸ iOS ç›¸å…³ï¼Œå¯¹å¤§å‰ç«¯ã€åç«¯éƒ½æœ‰ä¸€å®šæ¶‰çŒï¼Œå–œæ¬¢åˆ†äº«å¹²è´§åšæ–‡ã€‚
>
> å…¬ä¼—å·ï¼šCoderStarï¼Œåˆ†äº«å¤§å‰ç«¯ç›¸å…³çš„æŠ€æœ¯çŸ¥è¯†ï¼ŒåªèŠæŠ€æœ¯å¹²è´§ï¼Œç›®å‰åˆ†äº«çš„å†…å®¹ä¸»è¦æ˜¯ iOS ç›¸å…³çš„ï¼Œåç»­è¿˜ä¼šåˆ†äº«ä¸€äº› Flutterã€Vue å‰ç«¯ç­‰ç›¸å…³æŠ€æœ¯çŸ¥è¯†ã€‚ç›®å‰å…¬ä¼—å·æ–‡ç« å†…å®¹å‡æ˜¯è‡ªå·±åŸåˆ›ï¼Œå¾ˆæ¬¢è¿å¤§å®¶æŠ•ç¨¿ä¸€äº›å¥½æ–‡ç« ï¼Œå¤§å®¶ä¸€å—è¿›æ­¥ã€‚


zhangferryï¼šä¸ºä»€ä¹ˆæœ‰å†™å…¬ä¼—å·çš„æ‰“ç®—ï¼Ÿå†™å…¬ä¼—å·æœ‰å¸¦æ¥ä»€ä¹ˆå¥½å¤„å—ï¼Ÿ

> æœ€å¼€å§‹å†™å…¬ä¼—å·çš„åŸå› å…¶å®æ¯”è¾ƒç®€å•ï¼Œ
>
> 1ã€å› ä¸ºè¿‡å»ç§¯ç´¯äº†ä¸€äº›ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£ï¼Œæƒ³æ•´ç†ä¸€ä¸‹ï¼›
>
> 2ã€è§‰å¾—å·¥ä½œç»éªŒå·²ç»åˆ°äº†ä¸€å®šçš„é˜¶æ®µï¼Œä¹Ÿæ˜¯æ—¶å€™å°†çŸ¥è¯†æ¢³ç†ä¸€éï¼Œæ‰“é€ è‡ªå·±çš„çŸ¥è¯†ä½“ç³»äº†ï¼Œèä¼šè´¯é€šï¼›
>
> 3ã€æ˜¯æƒ³æŠŠè‡ªå·±ç§¯ç´¯çš„ä¸€äº›æŠ€æœ¯çŸ¥è¯†åˆ†äº«å‡ºæ¥ï¼Œå¤§å®¶ä¸€èµ·æ¥äº¤æµï¼Œåˆ›é€ ä¸€ä¸ªå¥½çš„æŠ€æœ¯åœˆå­ï¼Œä¸€ä¸ªå¥½çš„æŠ€æœ¯åœˆå­å®åœ¨æ˜¯å¤ªé‡è¦äº†ã€‚

> å†™å…¬ä¼—å·çš„å¥½å¤„ï¼š
>
> 1ã€å†™æ–‡ç« ä¸ä»…èƒ½è®©æˆ‘å¯¹ä¸€ä¸ªçŸ¥è¯†ç‚¹ç†è§£çš„æ›´é€å½»ï¼Œä¹Ÿå¢å¼ºäº†æˆ‘çš„å†™ä½œèƒ½åŠ›ï¼Œå¯¹äºæŠ€æœ¯çŸ¥è¯†è€Œè¨€ï¼Œè‡ªå·±ç†è§£æ˜¯ä¸€ä¸ªé˜¶æ®µï¼Œæ·±å…¥æµ…å‡ºçš„å†™å‡ºæ¥åˆæ˜¯ä¸€ä¸ªæ›´é«˜çš„é˜¶æ®µï¼›
>
> 2ã€å¯ä»¥è®¤è¯†å¾ˆå¤šå°ä¼™ä¼´ï¼ŒåŒè¡Œçš„è·¯ä¸Šä¸ä¼šå­¤å•ï¼Œæ¯”å¦‚å’Œé£å“¥å°±æ˜¯è¿™æ ·è®¤è¯†çš„ã€‚


zhangferryï¼šæœ€è¿‘åœ¨ç ”ç©¶ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿ï¼Ÿæ˜¯å¦å¯ä»¥é€éœ²ä¸‹æœªæ¥å‡ ç¯‡æ–‡ç« çš„è§„åˆ’ï¼Ÿ

> æœ€è¿‘åœ¨åšä¼˜åŒ–æ–¹é¢çš„äº‹æƒ…ï¼Œæœªæ¥å‡ ç¯‡æ–‡ç« å¯èƒ½ä¼šåå‘ä¼˜åŒ–ç³»åˆ—æˆ–è€…åº•å±‚ç›¸å…³ã€‚


zhangferryï¼šå¦‚ä½•è®©è‡ªå·±æ¯å‘¨éƒ½èƒ½æŠ½å‡ºæ—¶é—´å†™åšå®¢å‘¢ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å­¦ä¹ æ–¹æ³•å¯ä»¥åˆ†äº«ï¼Ÿ

> æˆ‘ç›®å‰æ›´æ–°çš„é¢‘ç‡æ˜¯ä¸€å‘¨ä¸€ç¯‡æ–‡ç« ï¼Œä¸€èˆ¬å·¥ä½œæ—¥æ™šä¸Šä¼šå»çœ‹ä¸€äº›æœ¬æœŸæ–‡ç« æ¶‰åŠçš„èµ„æ–™ä»¥åŠåšä¸€äº›ä»£ç å®è·µï¼Œç„¶åç§¯ç´¯ä¸€äº›ç¬”è®°ï¼Œåœ¨å‘¨æœ«æ—¶å€™å°†ç¬”è®°è¿›è¡Œæ•´ç†èšåˆï¼Œå½¢æˆæ–‡ç« ï¼Œå…¶å®è¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜æ˜¯æ¯”è¾ƒç´¯çš„ï¼Œæ¯•ç«Ÿæœ‰çš„æ—¶å€™å·¥ä½œä¼šå¿™ï¼Œä½†æ˜¯è¿™ä¸ªäº‹æƒ…ä¸€å®šè¦åšæŒï¼Œç»™è‡ªå·±ä¸€ä¸ªç›®æ ‡ï¼Œä¸èƒ½éšéšä¾¿ä¾¿å°±æ–­æ›´ï¼Œæ¯•ç«Ÿæœ‰ç¬¬ä¸€æ¬¡æ–­æ›´å°±æœ‰ç¬¬äºŒæ¬¡ã€‚
>
> å­¦ä¹ æ–¹æ³•ï¼šè¯´ä¸€ç‚¹å§ï¼Œæˆ‘è‡ªå·±å¯¹äºæŠ€æœ¯çš„æ€åº¦æ˜¯å®è·µå‹+æ›´ä¼˜è§£ï¼Œå½“çœ‹åˆ°ä¸€äº›å¥½çš„æ–‡ç« çš„æ—¶å€™ï¼Œä¼šè‡ªå·±å°†æ–‡ç« é‡Œé¢çš„åŸç†æˆ–è€…å®ç°è‡ªå·±åŠ¨æ‰‹å®è·µä¸€ä¸‹ï¼Œè€ƒè™‘è¿™ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Œå¹¶å›´ç»•è¿™ä¸ªæŠ€æœ¯ç‚¹å»æ€è€ƒæœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä¸æ–­åœ°å»å¯»æ‰¾æ›´ä¼˜è§£ã€‚

## å¼€å‘Tips

æ•´ç†ç¼–è¾‘ï¼š[RunsCode](https://github.com/RunsCode)ã€ [zhangferry](https://zhangferry.com)
###  å¦‚ä½•æ‘Šå¹³å¤æ‚é€»è¾‘æµç¨‹çš„è®¾è®¡

å¼€å‘ä¸­æˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

* è¿è¥æ´»åŠ¨ä¼˜å…ˆçº§é—®é¢˜
* åç»­æ…¢æ…¢åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é€æ¸è¡ç”Ÿæ–°çš„åŠŸèƒ½ï¼ˆå»¶æ—¶ï¼Œè½®è¯¢ï¼Œæ¡ä»¶æ ¡éªŒç­‰ï¼‰
* é€çº§é€’å¢çš„å›è°ƒåœ°ç‹±

#### Talk is cheap, show code

```swift
// 1
func function0() {
    obj0.closure { _ in
        // to do something
        obj1.closure { _ in
            // to do something                      
            obj2.closure { _ in
                ...
                objn.closure { _ in
                       ...
                }         
            }             
        }        
    }
}

or
// 2.
func function1 {
    if æ»¡è¶³æ´»åŠ¨0æ¡ä»¶ {
        // to do something
    } else if æ»¡è¶³æ´»åŠ¨1æ¡ä»¶ {
        // to do something
    } else if æ»¡è¶³æ´»åŠ¨2æ¡ä»¶ {
        // to do something
    }
    ...
    else {
        // to do something
    }
}
```

åˆ†æä¸Šé¢é‚£ç§ä»£ç æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹å‡ ç‚¹ç»“è®ºï¼š

* ä¸ç®¡æ€ä¹ˆçœ‹éƒ½æ˜¯æŒ‰æµç¨‹æˆ–è€…æ¡ä»¶è®¾è®¡çš„
* å¯è¯»æ€§è¿˜è¡Œï¼Œä½†å¯ç»´æŠ¤æ€§è¾ƒå·®ï¼ŒäºŒæ¬¡ä¿®æ”¹é”™è¯¯ç‡è¾ƒé«˜
* æ— æ‰©å±•æ€§ï¼Œåªèƒ½ä¸æ–­å¢åŠ ä»£ç çš„è¡Œæ•°ã€æ¡ä»¶åˆ†æ”¯ä»¥åŠæ›´æ·±å±‚çº§çš„å›è°ƒ
* å¦‚æœåŠŸèƒ½å‡çº§å¢åŠ ç±»ä¼¼å»¶è¿Ÿã€è½®è¯¢ï¼Œé‚£å®Œå…¨ä¸æ”¯æŒ
* å¤ç”¨æ€§å¯ä»¥è¯´æ— 

#### è§£å†³æ–¹æ¡ˆ

* å®ç°ä¸€ä¸ªå®¹å™¨ `Element` æ­è½½æ‰€æœ‰å¤–éƒ¨å®ç°é€»è¾‘
* å®¹å™¨ `Element` ä»¥å•å‘é“¾è¡¨çš„æ–¹å¼é“¾æ¥ï¼Œæ‰§è¡Œå®Œå°±è‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€ä¸ª
* å®¹å™¨å†…èšåˆä¸€ä¸ªæŠ½è±¡æ¡ä»¶é€»è¾‘åŠ©æ‰‹ `Promise`ï¼Œå¯éšæ„æ‰©å±•å¢åŠ è¡Œä¸ºï¼Œç”¨æ¥æ£€æŸ¥å¤–éƒ¨å®ç°æ˜¯å¦å¯ä»¥æ‰§è¡Œé“¾è¡¨ä¸‹ä¸€ä¸ª `Element`ï¼ˆå¯ä»¥å½¢è±¡ç†è§£ä¸ºè‡ªæ¥æ°´ç®¡è·¯çš„é˜€é—¨ï¼Œç”µè·¯ç”µæ°”å¼€å…³ä¹‹ç±»ï¼Œå½“ç„¶ä¼šæœ‰æ›´å¤æ‚çš„é˜€é—¨ä¸ç”µæ°”å¼€å…³ï¼‰
* è‡ªå·±ç®¡ç†è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ— éœ€å¤–éƒ¨å¼ºå¼•ç”¨
* å®¹å™¨ `Element` å¯ä»¥è¢«ç»§æ‰¿å®ç°ï¼Œå‚è€ƒ `NSOperation` è®¾è®¡

#### Example
```swift
private func head() -> PriorityElement<String, Int> {
    return PriorityElement(id: "Head") {  (promise: PriorityPromise<String, Int>) in
        Println("head input : \(promise.input ?? "")")
        self.delay(1) { promise.next(1) }
    }.subscribe { i in
        Println("head subscribe : \(i ?? -1)")
    }.catch { err in
        Println("head catch : \(String(describing: err))")
    }.dispose {
        Println("head dispose")
    }
}
// This is a minimalist way to create element, 
// using anonymous closure parameters and initializing default parameters
private func neck() -> PriorityElement<Int, String> {
    return PriorityElement {
        Println("neck input : \($0.input ?? -1)")
        $0.output = "I am Neck"
        $0.validated($0.input == 1)
    }.subscribe { ... }.catch { err in ... }.dispose { ... }
}
// This is a recommended way to create element, providing an ID for debugging
private func lung() -> PriorityElement<String, String> {
    return PriorityElement(id: "Lung") { 
        Println("lung input : \($0.input ?? "-1")")
        self.count += 1
        //
        $0.output = "I am Lung"
        $0.loop(validated: self.count >= 5, t: 1)
    }.subscribe { ... }.catch { err in ... }.dispose { ... }
}
private func heart() -> PriorityElement<String, String> {}
private func liver() -> PriorityElement<String, String> {}
private func over() -> PriorityElement<String, String> {}
// ... ...
let head: PriorityElement<String, Int> = self.head()
head.then(neck())
    .then(lung())
    .then(heart())
    .then(liver())
    .then(over())
// nil also default value()
head.execute()
```

ä¹Ÿè®¸å¤§å®¶çœ‹åˆ°è¿™é‡Œé—»åˆ°ä¸€è‚¡ç†Ÿæ‚‰çš„ Goolge `Promises`ã€mxcl çš„`PromiseKit` æˆ–è€… `RAC` ç­‰å‘³é“ï¼Œé‚£ä¹ˆä¸ºå•¥ä¸ç”¨é‚£äº›ä¸ªå¤§ç¥çš„æ¡†æ¶æ¥è§£å†³å®é™…é—®é¢˜å‘¢ï¼Ÿ

ä¸»è¦æœ‰ä¸€ç‚¹ï¼šæ¡†æ¶åŠŸèƒ½è¿‡äºä¸°å¯Œè€Œå¤æ‚ï¼Œè€Œæˆ‘å‘¢ï¼Œå¼±æ°´ä¸‰åƒæˆ‘åªè¦ä¸€ç“¢ï¼Œè¶Šè½»è¶Šå¥½çš„åŸåˆ™ï¼å“ˆå“ˆ

è¿™é‡Œå¯ä»¥çœ‹åˆ°[è¯¦ç»†çš„è®¾è®¡ä»‹ç»](https://www.yuque.com/runscode/ios-thinking/priority_element "PrioritySessionElementè®¾è®¡ä¸ä½¿ç”¨")ï¼Œç›®å‰æœ‰ `OCã€Swiftã€Java` ä¸‰ä¸ªç‰ˆæœ¬çš„å…·ä½“å®ç°ã€‚ä»“åº“åœ°å€ï¼šhttps://github.com/RunsCode/PromisePriorityChain æ¬¢è¿å¤§å®¶æŒ‡æ­£ã€‚

### é¡¹ç›®ä¸­åŒºåˆ† AppStore/Adhoc åŒ…ï¼ˆäºŒï¼‰

ä¸ŠæœŸä»‹ç»äº†ä¸€ç§çº¦å®š `Configuration`ï¼Œè‡ªå®šä¹‰é¢„ç¼–è¯‘å®è¿›è¡ŒåŒºåˆ† AppStore/Adhoc åŒ…çš„æ–¹æ³•ã€‚åæ¥å°è¯•å‘ç°è¿˜å¯ä»¥é€šè¿‡åº”ç”¨å†…é…ç½®æ–‡ä»¶ï¼ˆembedded.mobileprovisionï¼‰å’Œ IAP æ”¶æ®ååŒºåˆ†åŒ…ç±»å‹ã€‚

embedded.mobileprovison ä»…åœ¨é AppStore ç¯å¢ƒå­˜åœ¨ï¼Œè€Œä¸”å®ƒé‡Œé¢è¿˜æœ‰ä¸€ä¸ªå‚æ•° `aps-environment` å¯ä»¥åŒºåˆ†è¯ä¹¦çš„ç±»å‹æ˜¯ `development` è¿˜æ˜¯ `production`ï¼Œè¿™ä¸¤ä¸ªå€¼å°±å¯¹åº”äº† Development å’Œ AdHoc åŒ…ã€‚

å¦å¤– IAP åœ¨éä¸Šæ¶åœºæ™¯éƒ½æ˜¯æ²™ç›’ç¯å¢ƒï¼ˆä¸Šçº¿ AppStoreConnect çš„ TestFlight åŒ…ä¹Ÿæ˜¯æ²™ç›’ç¯å¢ƒï¼‰ï¼Œæ˜¯å¦ä¸ºæ”¯ä»˜çš„æ²™ç›’ç¯å¢ƒæˆ‘ä»¬å¯ä»¥ç”¨ `Bundle.main.appStoreReceiptURL?.lastPathComponent` æ˜¯å¦ä¸º `sandboxReceipt` è¿›è¡Œåˆ¤æ–­ã€‚

æ‰€ä»¥ä½¿ç”¨ä¸Šé¢ä¸¤é¡¹å†…å®¹æˆ‘ä»¬å¯ä»¥åŒºåˆ†ï¼šDevelopmentã€AdHocã€TestFlightã€AppStoreã€‚

#### è¯»å– embedded.mobileprovision

åœ¨å‘½ä»¤è¡Œä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ `security` è¯»å–ï¼š

```bash
$ security cms -D -i embedded.mobileprovision
```

åœ¨å¼€å‘é˜¶æ®µè¯»å–æ–¹å¼å¦‚ä¸‹ï¼š

```swift
struct MobileProvision: Decodable {
    var name: String
    var appIDName: String
    var platform: [String]
    var isXcodeManaged: Bool? = false
    var creationDate: Date
    var expirationDate: Date
    var entitlements: Entitlements
    
    private enum CodingKeys : String, CodingKey {
        case name = "Name"
        case appIDName = "AppIDName"
        case platform = "Platform"
        case isXcodeManaged = "IsXcodeManaged"
        case creationDate = "CreationDate"
        case expirationDate = "ExpirationDate"
        case entitlements = "Entitlements"
    }
    
    // Sublevel: decode entitlements informations
    struct Entitlements: Decodable {
        let keychainAccessGroups: [String]
        let getTaskAllow: Bool
        let apsEnvironment: Environment
        
        private enum CodingKeys: String, CodingKey {
            case keychainAccessGroups = "keychain-access-groups"
            case getTaskAllow = "get-task-allow"
            case apsEnvironment = "aps-environment"
        }
        // Occasionally there will be a disable
        enum Environment: String, Decodable {
            case development, production, disabled
        }
    }
}

class AppEnv {
    
    enum AppCertEnv {
        case devolopment
        case adhoc
        case testflight
        case appstore
    }
    
    var isAppStoreReceiptSandbox: Bool {
        return Bundle.main.appStoreReceiptURL?.lastPathComponent == "sandboxReceipt"
    }
    
    var embeddedMobileProvisionFile: URL? {
        return Bundle.main.url(forResource: "embedded", withExtension: "mobileprovision")
    }
    
    var appCerEnv: AppCertEnv!
    
    init() {
      	// init or other time
        assemblyEnv()
    }
    
    func assemblyEnv() {
        if let provision = parseMobileProvision() {
            switch provision.entitlements.apsEnvironment {
            case .development, .disabled:
                appCerEnv = .devolopment
            case .production:
                appCerEnv = .adhoc
            }
        } else {
            if isAppStoreReceiptSandbox {
                appCerEnv = .testflight
            } else {
                appCerEnv = .appstore
            }
        }
    }
    
    /// ref://gist.github.com/perlmunger/8318538a02166ab4c275789a9feb8992
    func parseMobileProvision() -> MobileProvision? {
        guard let file = embeddedMobileProvisionFile,
              let string = try? String.init(contentsOf: file, encoding: .isoLatin1) else {
            return nil
        }
        
        // Extract the relevant part of the data string from the start of the opening plist tag to the ending one.
        let scanner = Scanner.init(string: string)
        guard scanner.scanUpTo("<plist", into: nil) != false  else {
            return nil
        }
        var extractedPlist: NSString?
        guard scanner.scanUpTo("</plist>", into: &extractedPlist) != false else {
            return nil
        }
        
        guard let plist = extractedPlist?.appending("</plist>").data(using: .isoLatin1) else { return nil}
        
        let decoder = PropertyListDecoder()
        do {
            let provision = try decoder.decode(MobileProvision.self, from: plist)
            return provision
        } catch let error {
            // TODO: log / handle error
            print(error.localizedDescription)
            return nil
        }
    }
}
```

## é¢è¯•è§£æ

æ•´ç†ç¼–è¾‘ï¼š[å¸ˆå¤§å°æµ·è…¾](https://juejin.cn/user/782508012091645)

æœ¬æœŸé€šè¿‡ä¸€ä¸ª demo è®²è§£ `isMemberOfClass:`ã€`isKindOfClass:` ä¸¤ä¸ªæ–¹æ³•çš„ç›¸å…³çŸ¥è¯†ç‚¹ã€‚

**ä»¥ä¸‹æ‰“å°ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ**ï¼ˆä¸¥è°¨ç‚¹å°±æ·»åŠ ä¸ªè¯´æ˜å§ï¼šPerson ç±»ç»§æ‰¿äº NSObject ç±»ï¼‰

```objectivec
BOOL res1 = [[NSObject class] isKindOfClass:[NSObject class]];
BOOL res2 = [[NSObject class] isMemberOfClass:[NSObject class]];
BOOL res3 = [[Person class] isKindOfClass:[Person class]];
BOOL res4 = [[Person class] isMemberOfClass:[Person class]];

NSLog(@"%d, %d, %d, %d", res1, res2, res3, res4);
```

æ‰“å°ç»“æœï¼š1, 0, 0, 0

**è§£é‡Šï¼š**

ä»¥ä¸‹æ˜¯ objc4-723 ä¸­ `isMemberOfClass:`ã€`isKindOfClass:` æ–¹æ³•ä»¥åŠ `object_getClass()` å‡½æ•°çš„å®ç°ã€‚

```objectivec
+ (BOOL)isMemberOfClass:(Class)cls {
    return object_getClass((id)self) == cls;
}

- (BOOL)isMemberOfClass:(Class)cls {
    return [self class] == cls;
}

+ (BOOL)isKindOfClass:(Class)cls {
    for (Class tcls = object_getClass((id)self); tcls; tcls = tcls->superclass) {
        if (tcls == cls) return YES;
    }
    return NO;
}

- (BOOL)isKindOfClass:(Class)cls {
    for (Class tcls = [self class]; tcls; tcls = tcls->superclass) {
        if (tcls == cls) return YES;
    }
    return NO;
}

Class object_getClass(id obj)
{
    if (obj) return obj->getIsa();
    else return Nil;
}
```

emmm æ•´ç†çš„æ—¶å€™å‘ç°åé¢çš„ç‰ˆæœ¬åˆåšäº†å°ä¼˜åŒ–ï¼Œå…·ä½“å°±ä¸å±•å¼€äº†ï¼Œä¸è¿‡åŸç†ä¸å˜ï¼Œä»¥ä¸‹æ˜¯ 824 ç‰ˆæœ¬çš„ï¼š

```objectivec
+ (BOOL)isMemberOfClass:(Class)cls {
    return self->ISA() == cls;
}

- (BOOL)isMemberOfClass:(Class)cls {
    return [self class] == cls;
}

+ (BOOL)isKindOfClass:(Class)cls {
    for (Class tcls = self->ISA(); tcls; tcls = tcls->getSuperclass()) {
        if (tcls == cls) return YES;
    }
    return NO;
}

- (BOOL)isKindOfClass:(Class)cls {
    for (Class tcls = [self class]; tcls; tcls = tcls->getSuperclass()) {
        if (tcls == cls) return YES;
    }
    return NO;
}
```

ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š

* `isMemberOfClass:` æ–¹æ³•æ˜¯åˆ¤æ–­å½“å‰ `instance/class` å¯¹è±¡çš„ `isa` æŒ‡å‘æ˜¯ä¸æ˜¯ `class/meta-class` å¯¹è±¡ç±»å‹ï¼›
* `isKindOfClass:` æ–¹æ³•æ˜¯åˆ¤æ–­å½“å‰ `instance/class` å¯¹è±¡çš„ `isa` æŒ‡å‘æ˜¯ä¸æ˜¯ `class/meta-class` å¯¹è±¡æˆ–è€…å®ƒçš„å­ç±»ç±»å‹ã€‚

æ˜¾ç„¶ `isKindOfClass:` çš„èŒƒå›´æ›´å¤§ã€‚å¦‚æœæ–¹æ³•è°ƒç”¨è€…æ˜¯ instance å¯¹è±¡ï¼Œä¼ å‚å°±åº”è¯¥æ˜¯ class å¯¹è±¡ã€‚å¦‚æœæ–¹æ³•è°ƒç”¨ç€æ˜¯ class å¯¹è±¡ï¼Œä¼ å‚å°±åº”è¯¥æ˜¯ meta-class å¯¹è±¡ã€‚æ‰€ä»¥ res2-res4 éƒ½ä¸º 0ã€‚é‚£ä¸ºä»€ä¹ˆ res1 ä¸º 1 å‘¢ï¼Ÿ

å› ä¸º NSObject çš„ class çš„å¯¹è±¡çš„ isa æŒ‡å‘å®ƒçš„ meta-class å¯¹è±¡ï¼Œè€Œå®ƒçš„ meta-class çš„ superclass æŒ‡å‘å®ƒçš„ class å¯¹è±¡ï¼Œæ‰€ä»¥ `[[NSObject class] isKindOfClass:[NSObject class]]` æˆç«‹ ã€‚

![](https://gitee.com/zhangferry/Images/raw/master/iOSWeeklyLearning/objc-isa-class-diagram.jpg)

æ€»ä¹‹ï¼Œ`[instance/class isKindOfClass:[NSObject class]]` æ’æˆç«‹ã€‚ï¼ˆä¸¥è°¨ç‚¹ï¼Œéœ€è¦æ˜¯ NSObject åŠå…¶å­ç±»ç±»å‹ï¼‰


## ä¼˜ç§€åšå®¢

æ•´ç†ç¼–è¾‘ï¼š[çš®æ‹‰å¤«å¤§ç‹åœ¨æ­¤](https://www.jianshu.com/u/739b677928f7)ã€[æˆ‘æ˜¯ç†Šå¤§](https://juejin.cn/user/1151943916921885)

æœ¬æœŸä¸»é¢˜ï¼š`Swift æŒ‡é’ˆ`ã€`Swift å±æ€§åŒ…è£¹å™¨`

1ã€[Swift ä¸­çš„æŒ‡é’ˆä½¿ç”¨]( https://onevcat.com/2015/01/swift-pointer/  "Swift ä¸­çš„æŒ‡é’ˆä½¿ç”¨") -- æ¥è‡ªï¼šonevcat

Swift ä¸­æŒ‡é’ˆä½¿ç”¨åœºæ™¯å¹¶ä¸å¸¸è§ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬åˆä¸å¾—ä¸å°è¯•å»ä½¿ç”¨æŒ‡é’ˆï¼Œå› æ­¤è¿˜æ˜¯éœ€è¦å¯¹ Swift çš„æŒ‡é’ˆè¿ç”¨æœ‰ä¸€å®šçš„äº†è§£ã€‚è¿™ç¯‡æ–‡ç« æ˜¯å–µç¥ 15 å¹´å†™çš„ï¼Œå¹¶åœ¨ 2020 å¹´åšäº†æ›´æ–°ã€‚æ–‡ç« å¯¹ C æŒ‡é’ˆå’Œ Swift çš„æŒ‡é’ˆåº”ç”¨åšäº†æ˜ å°„ï¼Œå¯¹äºæœ‰ä¸€å®š C æŒ‡é’ˆåŸºç¡€çš„åŒå­¦é˜…è¯»æ¯”è¾ƒå‹å¥½ã€‚

2ã€[The 5-Minute Guide to C Pointers](https://denniskubes.com/2017/01/24/the-5-minute-guide-to-c-pointers/ "Cè¯­è¨€æŒ‡é’ˆ5åˆ†é’Ÿæ•™ç¨‹") -- æ¥è‡ªï¼šDennis Kubes

å–µç¥æ–‡ç« ä¸­æ¨èçš„ C è¯­è¨€æŒ‡é’ˆæ•™ç¨‹ï¼Œå¦‚æœå¯¹ C æŒ‡é’ˆä¸äº†è§£çš„è¯ï¼Œç›´æ¥åˆ‡å…¥åˆ° Swift çš„æŒ‡é’ˆè¿˜æ˜¯æœ‰ä¸€å®šçš„å›°éš¾çš„ã€‚

3ã€[Swift5.1 - æŒ‡é’ˆPointer](https://www.jianshu.com/p/8cff1ef20e8c "Swift5.1 - æŒ‡é’ˆPointer") -- æ¥è‡ªç®€ä¹¦ï¼šHChase

è¿™ç¯‡æ–‡ç« æ ¹æ® Swift çš„ç±»å‹ç»™å‡ºäº†å¤šç§ä½¿ç”¨æ–¹æ³•ï¼ŒæŸ¥æ‰¾ç”¨æ³•éå¸¸æ–¹ä¾¿ã€‚ä¾‹å¦‚ malloc ä¹‹åå¦‚ä½•å¡«å……å­—èŠ‚ã€å¦‚ä½•æ ¹æ®åœ°å€åˆ›å»ºæŒ‡é’ˆã€å¦‚ä½•è¿›è¡Œç±»å‹è½¬æ¢ç­‰ã€‚å¦‚æœåœ¨å¼€å‘ä¸­éœ€è¦ä½¿ç”¨ Swift çš„æŒ‡é’ˆï¼Œåœ¨ä¸ç†Ÿæ‚‰çš„æƒ…å†µä¸‹å¯ä»¥å‚è€ƒæ–‡ä¸­çš„å° demoã€‚

4ã€[ä½¿ç”¨ Property Wrapper ä¸º Codable è§£ç è®¾å®šé»˜è®¤å€¼](https://onevcat.com/2020/11/codable-default/ "ä½¿ç”¨ Property Wrapper ä¸º Codable è§£ç è®¾å®šé»˜è®¤å€¼
") -- æ¥è‡ªï¼šonevcat

åœ¨ Swift ä¸­ï¼Œjson è½¬ model å¯ä»¥ä½¿ç”¨ Codableï¼Œä½†å› ä¸ºå…¶æ— æ³•æŒ‡å®šå¯é€‰å€¼çš„é»˜è®¤å±æ€§ï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­éœ€è¦æ›´å†—ä½™çš„ä»£ç è¿›è¡Œè§£å¯é€‰æ“ä½œï¼›onevcat çš„è¿™ç¯‡æ–‡ç« å°±åˆ©ç”¨ Property Wrapper ä¸º Codable è§£ç è®¾å®šäº†é»˜è®¤å€¼ã€‚æ­¤å¤–æˆ‘å°†å…¶æ€»ç»“æˆäº†ä¸€ä¸ªæ–‡ä»¶ [SSCodableDefault.swift](https://github.com/Tliens/SpeedySwift/blob/master/Example/SpeedySwift/SSCodableDefault.swift)ï¼Œæ¬¢è¿å¤§å®¶ä½¿ç”¨ã€‚

5ã€[What is a Property Wrapper in Swift](https://sarunw.com/posts/what-is-property-wrappers-in-swift/#custom-logic-over-swift-properties "What is a Property Wrapper in Swift") -- æ¥è‡ªï¼šsarunw

å±æ€§åŒ…è£…å™¨æ˜¯ä¸€ç§åŒ…è£…å±æ€§ä»¥æ·»åŠ é¢å¤–é€»è¾‘çš„æ–°ç±»å‹ã€‚ä½œè€…å…ˆæŠ›å‡ºé—®é¢˜ï¼Œåˆ†æå±æ€§åŒ…è£…å™¨å‡ºç°ä¹‹å‰å¦‚ä½•å¯¹å±æ€§è¿›è¡ŒåŒ…è£…ä»¥åŠä»–é‡åˆ°çš„é—®é¢˜ï¼Œç„¶åæ¥åˆ©ç”¨å±æ€§åŒ…è£…å™¨å¯¹å±æ€§è¿›è¡Œé€»è¾‘åŒ…è£…ï¼Œæ¯”è¾ƒäº†äºŒç§æ–¹å¼çš„åŒºåˆ«ï¼Œç®€è¿°äº†å±æ€§åŒ…è£…å™¨çš„å¥½å¤„ã€‚

6ã€[Swift 5 å±æ€§åŒ…è£…å™¨Property Wrapperså®Œæ•´æŒ‡å—](https://juejin.cn/post/6844904018121064456 "Swift 5 å±æ€§åŒ…è£…å™¨Property Wrapperså®Œæ•´æŒ‡å—") -- æ¥è‡ªæ˜é‡‘ï¼šä¹Coding

æœ¬æ–‡æ˜¯ä½¿ç”¨å±æ€§åŒ…è£…å™¨çš„ä¸€ç¯‡ä¸­æ–‡æ•™ç¨‹ã€å¯ä»¥ç»“åˆ 4ã€5 é˜…è¯»ã€‚

## å­¦ä¹ èµ„æ–™

æ•´ç†ç¼–è¾‘ï¼š[Mimosa](https://juejin.cn/user/1433418892590136)

### Machine Learning Crash Course from Google

åœ°å€ï¼šhttps://developers.google.com/machine-learning/crash-course

æ¥è‡ª Google çš„æœºå™¨å­¦ä¹ æ•™ç¨‹èµ„æ–™ï¼Œä»¥ TensorFlow APIs ä¸ºåŸºç¡€ï¼Œè¿›è¡ŒåŒ…æ‹¬è§†é¢‘æ•™å­¦ã€çœŸå®çš„æ¡ˆä¾‹æ¢ç©¶å’ŒåŠ¨æ‰‹å®è·µç»ƒä¹ ã€‚ç”±äºæ˜¯è°·æ­Œæ”¯æŒçš„é¡¹ç›®ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨é€šè¿‡å­¦ä¹ ä¹‹åï¼Œå» Kaggle ç«èµ›è·å¾—çœŸå®ç«èµ›ç»éªŒï¼Œæˆ–è€…è®¿é—® [Learn with Google AI](https://ai.google/education)ï¼Œæ¢ç´¢æ›´å®Œæ•´çš„åŸ¹è®­èµ„æºåº“ã€‚

### ML-For-Beginners from Microsoft

åœ°å€ï¼šhttps://github.com/microsoft/ML-For-Beginners

æ¥è‡ª Microsoft çš„æœºå™¨å­¦ä¹ æ•™ç¨‹èµ„æ–™ã€‚æä¾›äº†ä¸€ä¸ªä¸ºæœŸ 12 å‘¨ã€æœ‰ 24 ä¸ªè¯¾æ—¶çš„å…³äºæœºå™¨å­¦ä¹ çš„è¯¾ç¨‹ã€‚åœ¨è¿™ä¸ªè¯¾ç¨‹ä¸­ï¼Œä½ å°†å­¦ä¹ ç»å…¸çš„æœºå™¨å­¦ä¹ ï¼Œä¸»è¦ä½¿ç”¨ Scikit-learn ä½œä¸ºä¸€ä¸ªåº“æ¥æ¥è§¦æœºå™¨å­¦ä¹ ã€‚è¿™åœ¨æˆ‘ä»¬å³å°†æ¨å‡ºçš„ã€ŒAIåˆå­¦è€…ã€è¯¾ç¨‹ä¸­æœ‰æ‰€æ¶‰åŠã€‚è¿™äº›è¯¾ç¨‹ä¹Ÿå¯ä»¥ä¸æˆ‘ä»¬å³å°†æ¨å‡ºçš„ã€Œæ•°æ®ç§‘å­¦åˆå­¦è€…ã€è¯¾ç¨‹æ­é…ä½¿ç”¨ã€‚æˆ‘ä»¬å°†è¿™äº›ç»å…¸æŠ€æœ¯åº”ç”¨äºä¸–ç•Œä¸Šè®¸å¤šåœ°åŒºçš„ä¸€äº›æ•°æ®ï¼Œè¯·ä¸æˆ‘ä»¬ä¸€èµ·åˆ°ä¸–ç•Œå„åœ°æ—…è¡Œï¼Œæ¥è¾¹å­¦ä¹ è¾¹æ—…è¡Œï¼åœ¨ Microsoft çš„ä»“åº“ä¸­ä½ ä¹Ÿå¯ä»¥æ‰¾åˆ°å…¶ä»–æ‰€æœ‰è¯¾ç¨‹ã€‚

### turicreate from Apple

åœ°å€ï¼šhttps://apple.github.io/turicreate/docs/userguide/

æ¥è‡ª Apple çš„ [turicreate](https://github.com/apple/turicreate) æ ·ä¾‹æ¨¡å‹ä»¥åŠç®€åŒ–æ¨¡å‹ç¨‹åºï¼Œä»–å¹¶ä¸æ˜¯å­¦ä¹ æœºå™¨å­¦ä¹ çš„æ•™ç¨‹ï¼Œè€Œæ˜¯ç»™ä½ æä¾›è§£å†³ä»»åŠ¡çš„æ–¹æ¡ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ turicreate æ¥è®­ç»ƒæ¨èç®—æ³•ã€å¯¹è±¡æ£€æµ‹ã€å›¾åƒåˆ†ç±»ã€å›¾åƒç›¸ä¼¼æ€§æˆ–æ´»åŠ¨åˆ†ç±»ç­‰ç®€å•çš„æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚é€šè¿‡äº§ç”Ÿçš„ `.mlmodel` æ¨¡å‹ï¼Œå¯ä»¥ç›´æ¥æ”¾åˆ°å·¥ç¨‹ä¸­ä½¿ç”¨ Core ML æ¥è½»æ¾ä½¿ç”¨ã€‚

## å·¥å…·æ¨è

æ•´ç†ç¼–è¾‘ï¼š[zhangferry](https://zhangferry.com)

### explainshell

**åœ°å€**ï¼šhttps://explainshell.com/

è¿™ä¸ªç½‘ç«™è·Ÿä¸ŠæœŸä»‹ç»çš„ [regex101](https://regex101.com) å¾ˆç±»ä¼¼ï¼Œä¸€ä¸ªç”¨äºè§£ææ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€ä¸ªç”¨äºè§£æ shell æŒ‡ä»¤ã€‚ä¸å¸¸æ¥è§¦ shell çš„å°ä¼™ä¼´å¯¹äºä¸€ä¸ªå‚æ•°å·¨å¤šï¼Œåˆå·¨é•¿çš„æŒ‡ä»¤å¯èƒ½ä¼šæ‰‹è¶³æ— æªï¼Œæ²¡å…³ç³»ï¼Œè¿™ä¸ªç½‘ç«™æ¥å¸®ä½ ğŸ˜ã€‚å®ƒä¼šæŠŠä¸»è¦å‘½ä»¤å’Œå„ä¸ªå‚æ•°ï¼Œä¼ å€¼è¿›è¡Œè¯¦ç»†çš„æ‹†åˆ†è®²è§£ã€‚æ¯”å¦‚è¿™å¥åˆ—å‡ºæ‰€æœ‰åŒ…å« `1a1b1c` è¿™ä¸€ commit çš„åˆ†æ”¯ï¼š

```bash
git branch -a -v --no-abbrev --contains 1a1b1c
```

è§£æç»“æœï¼š

![](https://gitee.com/zhangferry/Images/raw/master/iOSWeeklyLearning/20210814184638.png)

## å…³äºæˆ‘ä»¬

iOS æ‘¸é±¼å‘¨æŠ¥ï¼Œä¸»è¦åˆ†äº«å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„ç»éªŒæ•™è®­ã€ä¼˜è´¨çš„åšå®¢ã€é«˜è´¨é‡çš„å­¦ä¹ èµ„æ–™ã€å®ç”¨çš„å¼€å‘å·¥å…·ç­‰ã€‚å‘¨æŠ¥ä»“åº“åœ¨è¿™é‡Œï¼šhttps://github.com/zhangferry/iOSWeeklyLearning ï¼Œå¦‚æœä½ æœ‰å¥½çš„çš„å†…å®¹æ¨èå¯ä»¥é€šè¿‡ issue çš„æ–¹å¼è¿›è¡Œæäº¤ã€‚å¦å¤–ä¹Ÿå¯ä»¥ç”³è¯·æˆä¸ºæˆ‘ä»¬çš„å¸¸é©»ç¼–è¾‘ï¼Œä¸€èµ·ç»´æŠ¤è¿™ä»½å‘¨æŠ¥ã€‚å¦å¯å…³æ³¨å…¬ä¼—å·ï¼šiOSæˆé•¿ä¹‹è·¯ï¼Œåå°ç‚¹å‡»è¿›ç¾¤äº¤æµï¼Œè”ç³»æˆ‘ä»¬ï¼Œè·å–æ›´å¤šå†…å®¹ã€‚

### å¾€æœŸæ¨è

[iOSæ‘¸é±¼å‘¨æŠ¥ ç¬¬äºŒåäºŒæœŸ](https://mp.weixin.qq.com/s/JI5mlzX9cYhXJS81k1WE6A)

[iOSæ‘¸é±¼å‘¨æŠ¥ ç¬¬äºŒåä¸€æœŸ](https://mp.weixin.qq.com/s/Hcd8CtkyqD8IXM0SbVJo-A)

[iOSæ‘¸é±¼å‘¨æŠ¥ ç¬¬äºŒåæœŸ](https://mp.weixin.qq.com/s/PjiZzx3VSAfAGHRJs160aQ)

[iOSæ‘¸é±¼å‘¨æŠ¥ ç¬¬åä¹æœŸ](https://mp.weixin.qq.com/s/dtyozlqCO7PcpyGhx2qB5g)

![](https://gitee.com/zhangferry/Images/raw/master/iOSWeeklyLearning/WechatIMG384.jpeg)
